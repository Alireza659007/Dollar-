<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>سایت دلار</title>
  <style>
    body {
      font-family: Tahoma;
      background: linear-gradient(to bottom, #008000, #4B0082);
      color: white;
      padding: 20px;
      direction: rtl;
    }
    .hidden { display: none; }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
    }
    section {
      background-color: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
  </style>
</head>
<body><h2>ثبت نام</h2>
<section>
  <input id="regUser" placeholder="نام کاربری">
  <input id="regPass" placeholder="رمز عبور" type="password">
  <button onclick="register()">ثبت نام</button>
  <p id="regMsg"></p>
</section><h2>ورود</h2>
<section>
  <input id="loginUser" placeholder="نام کاربری">
  <input id="loginPass" placeholder="رمز عبور" type="password">
  <button onclick="login()">ورود</button>
  <p id="loginMsg"></p>
</section><section id="userPanel" class="hidden">
  <h3>سلام <span id="username"></span></h3>
  <p>موجودی شما: <span id="balance">0</span>$</p>
  <input id="codeInput" placeholder="کد دلار">
  <button onclick="redeemCode()">ثبت کد</button>
  <p id="redeemMsg"></p>  <h4>انتقال دلار</h4>
  <input id="toUser" placeholder="نام کاربری مقصد">
  <input id="amount" type="number" placeholder="مقدار دلار">
  <button onclick="transfer()">انتقال</button>
  <p id="transferMsg"></p><button onclick="logout()">خروج</button>

</section><h2>ورود پنل مدیریت</h2>
<section>
  <input id="adminPass" type="password" placeholder="رمز مدیریت">
  <button onclick="adminLogin()">ورود</button>
  <p id="adminMsg"></p>
</section><section id="adminPanel" class="hidden">
  <h3>پنل مدیریت</h3>
  <input id="newAmount" type="number" placeholder="مقدار دلار">
  <button onclick="generateCode()">ساخت کد</button>
  <p id="newCodeDisplay"></p>  <input id="deleteUser" placeholder="نام کاربری برای حذف">
  <button onclick="deleteAccount()">حذف کاربر</button>
  <p id="deleteMsg"></p>
  <button onclick="logoutAdmin()">خروج</button>
</section><h3>جدول 10 نفر برتر</h3>
<table>
  <thead>
    <tr><th>رتبه</th><th>نام</th><th>موجودی ($)</th></tr>
  </thead>
  <tbody id="scoreTable"></tbody>
</table><script>
  const ADMIN_PASSWORD = "admin123";
  let users = JSON.parse(localStorage.getItem("users") || "{}");
  let codes = JSON.parse(localStorage.getItem("codes") || "{}");
  let currentUser = null;

  function saveData() {
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("codes", JSON.stringify(codes));
  }

  function register() {
    const u = regUser.value.trim();
    const p = regPass.value;
    if (!u || !p) return regMsg.innerText = "نام کاربری و رمز را وارد کنید";
    if (users[u]) return regMsg.innerText = "نام قبلا ثبت شده است";
    users[u] = { password: p, balance: 0 };
    saveData();
    regMsg.innerText = "ثبت نام موفق بود";
  }

  function login() {
    const u = loginUser.value.trim();
    const p = loginPass.value;
    if (!u || !p || !users[u] || users[u].password !== p) return loginMsg.innerText = "نام یا رمز اشتباه است";
    currentUser = u;
    loginMsg.innerText = "";
    document.getElementById("username").innerText = currentUser;
    updateBalance();
    show("userPanel");
    updateTable();
  }

  function logout() {
    currentUser = null;
    hide("userPanel");
  }

  function updateBalance() {
    balance.innerText = users[currentUser].balance;
  }

  function redeemCode() {
    const code = codeInput.value.trim();
    if (!codes[code]) return redeemMsg.innerText = "کد نامعتبر است";
    if (codes[code].used) return redeemMsg.innerText = "کد قبلا استفاده شده است";
    users[currentUser].balance += codes[code].amount;
    codes[code].used = true;
    saveData();
    updateBalance();
    updateTable();
    redeemMsg.innerText = `دریافت شد: ${codes[code].amount}$`;
  }

  function transfer() {
    const to = toUser.value.trim();
    const amt = parseInt(amount.value);
    if (!users[to]) return transferMsg.innerText = "کاربر مقصد وجود ندارد";
    if (users[currentUser].balance < amt) return transferMsg.innerText = "موجودی کافی نیست";
    users[currentUser].balance -= amt;
    users[to].balance += amt;
    saveData();
    updateBalance();
    updateTable();
    transferMsg.innerText = `انتقال موفق: ${amt}$ به ${to}`;
  }

  function updateTable() {
    const tbody = document.getElementById("scoreTable");
    tbody.innerHTML = "";
    const sorted = Object.entries(users).sort((a, b) => b[1].balance - a[1].balance).slice(0, 10);
    sorted.forEach(([u, d], i) => {
      const row = `<tr><td>${i + 1}</td><td>${u}</td><td>${d.balance}$</td></tr>`;
      tbody.innerHTML += row;
    });
  }

  function adminLogin() {
    if (adminPass.value === ADMIN_PASSWORD) {
      show("adminPanel");
      adminMsg.innerText = "";
    } else {
      adminMsg.innerText = "رمز اشتباه است";
    }
  }

  function generateCode() {
    const amt = parseInt(newAmount.value);
    if (!amt) return;
    const c = Math.random().toString(36).substr(2, 8).toUpperCase();
    codes[c] = { amount: amt, used: false };
    saveData();
    newCodeDisplay.innerText = `کد: ${c} (${amt}$)`;
  }

  function deleteAccount() {
    const u = deleteUser.value.trim();
    if (users[u]) {
      delete users[u];
      saveData();
      deleteMsg.innerText = "حذف شد";
      updateTable();
    } else {
      deleteMsg.innerText = "یافت نشد";
    }
  }

  function logoutAdmin() {
    hide("adminPanel");
  }

  function show(id) {
    document.getElementById(id).classList.remove("hidden");
  }

  function hide(id) {
    document.getElementById(id).classList.add("hidden");
  }

  updateTable();
</script></body>
</html>
